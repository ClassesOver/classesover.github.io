<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="flutter, dart">










<meta name="description" content="英文地址：Animations in Flutter - easy guide - tutorial  origin  动画三大支柱 （The 3 pillars of an Animation）为了实现一个动画，需要存在下面三个元素：  一个Ticker 一个Animation 一个AnimaionController  下面这里先简单介绍这些元素，随后进行更详细的解释。 Ticker简而言之，">
<meta name="keywords" content="flutter">
<meta property="og:type" content="article">
<meta property="og:title" content="Flutter简易动画教程指南">
<meta property="og:url" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/index.html">
<meta property="og:site_name" content="Camera&#39;s Blog">
<meta property="og:description" content="英文地址：Animations in Flutter - easy guide - tutorial  origin  动画三大支柱 （The 3 pillars of an Animation）为了实现一个动画，需要存在下面三个元素：  一个Ticker 一个Animation 一个AnimaionController  下面这里先简单介绍这些元素，随后进行更详细的解释。 Ticker简而言之，">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_guillotine_original.gif">
<meta property="og:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_ticker_values.png">
<meta property="og:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_ticker_values2.png">
<meta property="og:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_10_secs.png">
<meta property="og:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_menu_explaination.png">
<meta property="og:updated_time" content="2019-01-12T15:40:10.737Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flutter简易动画教程指南">
<meta name="twitter:description" content="英文地址：Animations in Flutter - easy guide - tutorial  origin  动画三大支柱 （The 3 pillars of an Animation）为了实现一个动画，需要存在下面三个元素：  一个Ticker 一个Animation 一个AnimaionController  下面这里先简单介绍这些元素，随后进行更详细的解释。 Ticker简而言之，">
<meta name="twitter:image" content="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/animation_guillotine_original.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/">





  <title>Flutter简易动画教程指南 | Camera's Blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Camera's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/10/Flutter简易动画教程指南/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="编号15077">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Camera's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Flutter简易动画教程指南</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T22:29:06+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>英文地址：<a href="https://www.didierboelens.com/2018/06/animations-in-flutter---easy-guide---tutorial/" target="_blank" rel="noopener">Animations in Flutter - easy guide - tutorial</a></p>
<p><img src="/2019/01/10/Flutter简易动画教程指南/animation_guillotine_original.gif" width="400px" align="center"></p>
<center><font size="2">origin</font></center>

<h4 id="动画三大支柱-（The-3-pillars-of-an-Animation）"><a href="#动画三大支柱-（The-3-pillars-of-an-Animation）" class="headerlink" title="动画三大支柱 （The 3 pillars of an Animation）"></a>动画三大支柱 （The 3 pillars of an <strong>Animation</strong>）</h4><p>为了实现一个动画，需要存在下面三个元素：</p>
<ol>
<li>一个<strong>Ticker</strong></li>
<li>一个<strong>Animation</strong></li>
<li>一个<strong>AnimaionController</strong></li>
</ol>
<p>下面这里先简单介绍这些元素，随后进行更详细的解释。</p>
<h5 id="Ticker"><a href="#Ticker" class="headerlink" title="Ticker"></a>Ticker</h5><p>简而言之，<code>Ticker</code>是这样一个类，以几乎固定的间隔来发送一个信号（大约每秒60次），想想你的表，每秒都在走。</p>
<p>在每个<code>tick</code>循环中，<code>Ticker</code>触发回调函数，持续时间从第一个tick开始算起。</p>
<p>所有的<code>Ticker</code>即使从不同的时间开始，总会是同步的。这对动画同步是很有用的。</p>
<h5 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h5><p>动画其实没什么就是特定类型的值，在动画的生命周期中会发生变化。其值随动画时间可以是线性的（如1，2，3，4，5，…），也可以是复杂的（曲线）。</p>
<h5 id="AnimationController"><a href="#AnimationController" class="headerlink" title="AnimationController"></a>AnimationController</h5><p>该类用户控制（开始，停止，重复…）一个动画（或多个动画）。换句话说，以一定速率（每秒值的变化速率），使得动画的值在某一个持续时间内，从下限变化到上限。</p>
<h4 id="动画控制器-（AnimationController）"><a href="#动画控制器-（AnimationController）" class="headerlink" title="动画控制器 （AnimationController）"></a>动画控制器 （AnimationController）</h4><p>该类用于控制一个动画，精确地说，应该是<em>“over a sence”</em>一个场景。随后我们将会看到，多个不同的动画由同一控制器控制。</p>
<p>所以，在动画控制器这个类中，我们可以：</p>
<ul>
<li>向前，向后播放一个场景</li>
<li>停止一个场景</li>
<li>将场景设置为某个值</li>
<li>定义场景的边界值（下限，上限）</li>
</ul>
<p>下面的伪代码，展示了该勒不同的初始化参数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AnimationController controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">	value:		<span class="comment">// the current value of the animation, usually 0.0 (= default)</span></span><br><span class="line">	lowerBound:	<span class="comment">// the lowest value of the animation, usually 0.0 (= default)</span></span><br><span class="line">	upperBound:	<span class="comment">// the highest value of the animation, usually 1.0 (= default)</span></span><br><span class="line">	duration:	<span class="comment">// the total duration of the whole animation (scene)</span></span><br><span class="line">	vsync:		<span class="comment">// the ticker provider</span></span><br><span class="line">	debugLabel:	<span class="comment">// a label to be used to identify the controller</span></span><br><span class="line">			<span class="comment">// during debug session</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>大多数时候，在初始化<strong>AnimationController</strong>的时候，<code>value</code>，<code>lowerBound</code>，<code>upperBound</code>和<code>debugLabel</code>不会涉及到。</p>
<h5 id="如何将动画控制器绑定到Ticker？"><a href="#如何将动画控制器绑定到Ticker？" class="headerlink" title="如何将动画控制器绑定到Ticker？"></a>如何将动画控制器绑定到Ticker？</h5><p>为了能够工作，一个<code>AnimationController</code>需要绑定到一个<code>Ticker</code>上。</p>
<p>通常，生成一个<code>Ticker</code>，链接到<code>Stateful</code>组件的实例。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyStateWidget</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyStateWidget</span>&gt;</span></span><br><span class="line"><span class="class">		<span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">	AnimationController _controller;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="keyword">void</span> initState()&#123;</span><br><span class="line">	  <span class="keyword">super</span>.initState();</span><br><span class="line">	  _controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">		duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), </span><br><span class="line">		vsync: <span class="keyword">this</span>,</span><br><span class="line">	  );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="keyword">void</span> dispose()&#123;</span><br><span class="line">	  _controller.dispose();</span><br><span class="line">	  <span class="keyword">super</span>.dispose();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第2行，你告诉Flutter你想要一个新的<code>Ticker</code>，链接到<code>MyStateWidget</code>实例上。</li>
<li>第8-10行，初始化控制器，场景总的持续时间设置为1000毫秒，并绑定到<code>Ticker</code>上（<code>vsync:this</code>）。隐式参数：<code>lowerBound=0.0</code>，<code>upperBound=1.0</code>。</li>
<li>第16行，这是非常重要的，在<code>MyStateWidget</code>组件被销毁的时候，释放这个控制器。</li>
</ul>
<blockquote>
<p><strong>TickerProviderStateMixin 还是 SingleTickerProviderStateMixin?</strong></p>
<p>如果你有多个<code>AnimationController</code>实例，并且你想有不同的<code>Ticker</code>，使用<code>TickerProviderStateMixin</code>替换<code>SingleTickerProviderstateMixin</code>。</p>
</blockquote>
<h5 id="控制器已经绑定到Ticker上，但是这有什么作用呢？"><a href="#控制器已经绑定到Ticker上，但是这有什么作用呢？" class="headerlink" title="控制器已经绑定到Ticker上，但是这有什么作用呢？"></a>控制器已经绑定到Ticker上，但是这有什么作用呢？</h5><p>多亏了<code>ticker</code>，每秒钟大约60次tick循环，<code>AnimationController</code>在给定的持续时间内，线性地从下限到上限产生值。</p>
<p>例如下图，在1000毫秒内产生了这些值：</p>
<p><img src="/2019/01/10/Flutter简易动画教程指南/animation_ticker_values.png" width="400px" align="center"></p>
<p>我们看到，这些值在<code>1000</code>毫秒内从<code>0.0</code>（下限）变化到<code>1.0</code>（上限），产生了51个不同的值。</p>
<p>让我们展开看看代码，是如何使用的：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyStateWidget</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyStateWidget</span>&gt;</span></span><br><span class="line"><span class="class">		<span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">	AnimationController _controller;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="keyword">void</span> initState()&#123;</span><br><span class="line">	  <span class="keyword">super</span>.initState();</span><br><span class="line">	  _controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">		duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), </span><br><span class="line">		vsync: <span class="keyword">this</span>,</span><br><span class="line">	  );</span><br><span class="line">	  _controller.addListener(()&#123;</span><br><span class="line">		  setState(()&#123;&#125;);</span><br><span class="line">	  &#125;);</span><br><span class="line">	  _controller.forward();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="keyword">void</span> dispose()&#123;</span><br><span class="line">	  _controller.dispose();</span><br><span class="line">	  <span class="keyword">super</span>.dispose();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	Widget build(BuildContext context)&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="built_in">int</span> percent = (_controller.value * <span class="number">100.0</span>).round();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Scaffold(</span><br><span class="line">			body: <span class="keyword">new</span> Container(</span><br><span class="line">				child: <span class="keyword">new</span> Center(</span><br><span class="line">					child: <span class="keyword">new</span> Text(<span class="string">'<span class="subst">$percent</span>%'</span>),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第12行，这一行告诉控制器，每当它的值发生变化，我们需要重新构建这个组件（通过<code>setState()</code>）。</li>
<li>第15行，一旦组件初始化完成，我们告诉控制器开始计数（<code>forward()</code>，从下限到上限）。</li>
<li>第26行，我们取到控制器的值（<code>_controller.value</code>）。在这个例子中，值从<code>0.0</code>变化到<code>1.0</code>（<code>0%</code>到<code>100%</code>），我们得到表达式百分比，显示到页面中央。</li>
</ul>
<h4 id="动画的概念-（The-notion-of-Animation）"><a href="#动画的概念-（The-notion-of-Animation）" class="headerlink" title="动画的概念 （The notion of Animation）"></a>动画的概念 （The notion of Animation）</h4><p>如我们所见，控制器返回一系列浮点型值，呈线性变化。</p>
<p>某些时候，我常常：</p>
<ul>
<li>使用其他类型的值，诸如<code>Offset</code>，<code>int</code>…</li>
<li>使用不同的值范围，而不是<code>0.0</code>到<code>1.0</code></li>
<li>考虑其他变体类型，而非线形地展示出一些效果</li>
</ul>
<h5 id="使用其他类型的值"><a href="#使用其他类型的值" class="headerlink" title="使用其他类型的值"></a>使用其他类型的值</h5><p>为了能够使用其他类型的值，<code>Animation</code>类使用了模板。</p>
<p>换句话说，你可以这样定义：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Animation&lt;<span class="built_in">int</span>&gt; integerVariation;</span><br><span class="line">Animation&lt;<span class="built_in">double</span>&gt; decimalVariation;</span><br><span class="line">Animation&lt;Offset&gt; offsetVariation;</span><br></pre></td></tr></table></figure>
<h5 id="使用不同的值范围"><a href="#使用不同的值范围" class="headerlink" title="使用不同的值范围"></a>使用不同的值范围</h5><p>某些时候，我们想要两个值之间的变体，而不是<code>0.0</code>和<code>1.0</code> 。</p>
<p>为了定义这个范围，我们将要使用<code>Tween</code>类。</p>
<p>为了说明这些，我们考虑这种情况，你可能想要角弧度从<code>0</code>变化到<code>π/2</code>。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Animation&lt;<span class="built_in">double</span>&gt; angleAnimation = <span class="keyword">new</span> Tween(begin:<span class="number">0.0</span>,end:pi/<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h5 id="变体类型"><a href="#变体类型" class="headerlink" title="变体类型"></a>变体类型</h5><p>之前有讲过，从下限到上限的默认变化方式是线性的，这个是控制器的工作方式。</p>
<p>如果你想要一个角度从<code>0</code>变化到<code>π/2</code>弧度，绑定<code>Animation</code>到<code>AnimationController</code>。</p>
<p>当你开始这个动画（通过<code>_controller.forward()</code>），这个<code>angleAnimation.value</code>将会使用<code>_controller.value</code>来进行插值，范围<code>[0.0;π/2]</code>。</p>
<p>下面这幅图显示了线性变体(π/2 = 1.57)：</p>
<p><img src="/2019/01/10/Flutter简易动画教程指南/animation_ticker_values2.png" width="400px" align="center"></p>
<p>使用这些变体：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Animation&lt;<span class="built_in">double</span>&gt; angleAnimation = <span class="keyword">new</span> Tween(begin: <span class="number">0.0</span>, end: pi/<span class="number">2</span>).animate(</span><br><span class="line">	<span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">		parent: _controller,</span><br><span class="line">		curve:  Curves.ease,</span><br><span class="line">		reverseCurve: Curves.easeOut</span><br><span class="line">	));</span><br></pre></td></tr></table></figure>
<p>这个将会创建[0; π/2]变体：</p>
<ul>
<li>当动画从0.0 -&gt; π/2的时候，使用<code>Curves.ease</code>(=forward)</li>
<li>当动画从π/2 -&gt; 0.0的时候，使用<code>Curves.easeOut</code>（=revserse）</li>
</ul>
<h4 id="控制动画-（Controlling-the-animation）"><a href="#控制动画-（Controlling-the-animation）" class="headerlink" title="控制动画 （Controlling the animation）"></a>控制动画 （Controlling the animation）</h4><p><code>AnimationController</code>这个类允许你通过API来控制动画（下面是最常使用的API）:</p>
<ul>
<li><p><code>_controller.forward({double from})</code></p>
<p>要求控制器从下限到上限变化值，<code>from</code>可选参数用于控制器强制从其他值开始计数。</p>
</li>
<li><p><code>_controller.revserse({double from})</code></p>
<p>要求控制器从上限到下限变化值，<code>from</code>可选参数用于控制器强制从其他值开始计数。</p>
</li>
<li><p><code>_controller.stop({bool canceled:true})</code></p>
<p>停止运行动画。</p>
</li>
<li><p>_controller.reset()`</p>
<p>重置动画至下限。</p>
</li>
<li><p><code>_controller.animateTo({double min,double max,Duration period})</code></p>
<p>驱动动画从当前值变化到目标值。</p>
</li>
<li><p>_controller.repeat({double min,double max,Duration period})`</p>
<p>按forward方向开始运行这个动画，当它完成的时候重启这个动画。</p>
<p>如果定义，则min和max限制重复发生的次数。</p>
</li>
</ul>
<h5 id="保证安全"><a href="#保证安全" class="headerlink" title="保证安全"></a>保证安全</h5><p>因为动画可能意外终止（例如，屏幕被关闭），当使用这些API的时候，可以添加<code>.orCancel</code>来保证安全：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_controller.forward().orCancel;</span><br></pre></td></tr></table></figure>
<p>由于这个小技巧，在<code>_controller</code>被销毁前，如果<code>Ticker</code>被取消将不会抛出任何异常。</p>
<h5 id="场景的概念"><a href="#场景的概念" class="headerlink" title="场景的概念"></a>场景的概念</h5><p>“scene”这个 词并不存在官方文档中，只是个人认为。我发现这个贴近实际，来让我解释：</p>
<p>正如我所说的，一个动画控制器管理一个动画。然而，我们可以理解<code>Animation</code>为一系列子动画，线性或堆叠地播放，这个如何链接这些子动画在一起的定义就是我所说的“scene”。</p>
<p>考略下面这个案例，动画整个持续时间将会是10秒，我们想要的是：</p>
<ul>
<li>前2秒，一个球从左边移动到屏幕中央</li>
<li>然后，同是这个球，花费2秒从中心位置移动到屏幕上方中心位置</li>
<li>最后，花费5秒淡出</li>
</ul>
<p>你可能早已想到，我们不得不考虑三个不同的动画：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Definition of the _controller with a whole duration of 10 seconds</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">AnimationController _controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">	duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>), </span><br><span class="line">	vsync: <span class="keyword">this</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// First animation that moves the ball from the left to the center</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;Offset&gt; moveLeftToCenter = <span class="keyword">new</span> Tween(</span><br><span class="line">	begin: <span class="keyword">new</span> Offset(<span class="number">0.0</span>, screenHeight /<span class="number">2</span>), </span><br><span class="line">	end: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, screenHeight /<span class="number">2</span>)</span><br><span class="line">).animate(_controller);</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Second animation that moves the ball from the center to the top</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;Offset&gt; moveCenterToTop = <span class="keyword">new</span> Tween(</span><br><span class="line">	begin: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, screenHeight /<span class="number">2</span>), </span><br><span class="line">	end: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, <span class="number">0.0</span>)</span><br><span class="line">).animate(_controller);</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Third animation that will be used to change the opacity of the ball to make it disappear</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;<span class="built_in">double</span>&gt; disappear = <span class="keyword">new</span> Tween(</span><br><span class="line">	begin: <span class="number">1.0</span>, </span><br><span class="line">	end: <span class="number">0.0</span></span><br><span class="line">).animate(_controller);</span><br></pre></td></tr></table></figure>
<p>现在的问题是，如何链接（或编排）这些子动画呢？</p>
<h5 id="间隔的概念"><a href="#间隔的概念" class="headerlink" title="间隔的概念"></a>间隔的概念</h5><p>通过使用<code>Interval</code>类来解决，但是什么是<code>interval</code>呢？</p>
<p>与我们脑海中首先想到的相矛盾的是，这个是与时间间隔无关的，而是一个值的范围。</p>
<p>如果你想到<code>_controller</code>，你必须记住它使得值从下限到上限变化。</p>
<p>通常地，这两个值分别对应在<code>lowerBound=0.0</code>和<code>upperBound=1.0</code>，这使得事情更容易考虑些，因为<code>[0.0 -&gt; 1.0]</code>只不过是从0%到100%的变化。因此，如果一个场景的总持续时间是<code>10</code>秒，那么很有可能在5秒之后，对应的<code>_controller.value</code>将非常接近<code>0.5</code>(= 50%)。 </p>
<p>如果我们把三个不同的动画放在一个时间线上：</p>
<p><img src="/2019/01/10/Flutter简易动画教程指南/animation_10_secs.png" width="400px" align="center"></p>
<p>如果我们为三个动画的每个考虑值的区间，得到如下：</p>
<ul>
<li><p>moveLeftToCenter</p>
<p>持续时间：2秒，开始在0秒，结束在2秒 =&gt; 范围 =[0;2] =&gt; </p>
<p>百分比：整个场景从0%到20% =&gt; [0.0;0.20]</p>
</li>
<li><p>moveCenterToTop</p>
<p>持续时间：3秒，开始在2秒，结束在5秒 =&gt; 范围 =[2;5] =&gt;</p>
<p>百分比：整个场景从20%到50% =&gt; [0.20;0.50]</p>
</li>
<li><p>disapper</p>
<p>持续时间：5秒，开始在5秒，结束在10秒 =&gt; 范围 = [5;10] =&gt;<br>百分比：整个场景从50%到100% =&gt; [0.50;1.0]</p>
</li>
</ul>
<p>现在，我们有了这些百分比，我们可更新各个动画的定义如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Definition of the _controller with a whole duration of 10 seconds</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">AnimationController _controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">	duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>), </span><br><span class="line">	vsync: <span class="keyword">this</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// First animation that moves the ball from the left to the center</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;Offset&gt; moveLeftToCenter = <span class="keyword">new</span> Tween(</span><br><span class="line">	begin: <span class="keyword">new</span> Offset(<span class="number">0.0</span>, screenHeight /<span class="number">2</span>), </span><br><span class="line">	end: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, screenHeight /<span class="number">2</span>)</span><br><span class="line">	).animate(</span><br><span class="line">            <span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">                parent: _controller,</span><br><span class="line">                curve:  <span class="keyword">new</span> Interval(</span><br><span class="line">                    <span class="number">0.0</span>,</span><br><span class="line">                    <span class="number">0.20</span>,</span><br><span class="line">                    curve: Curves.linear,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Second animation that moves the ball from the center to the top</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;Offset&gt; moveCenterToTop = <span class="keyword">new</span> Tween(</span><br><span class="line">	begin: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, screenHeight /<span class="number">2</span>), </span><br><span class="line">	end: <span class="keyword">new</span> Offset(screenWidth /<span class="number">2</span>, <span class="number">0.0</span>)</span><br><span class="line">	).animate(</span><br><span class="line">            <span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">                parent: _controller,</span><br><span class="line">                curve:  <span class="keyword">new</span> Interval(</span><br><span class="line">                    <span class="number">0.20</span>,</span><br><span class="line">                    <span class="number">0.50</span>,</span><br><span class="line">                    curve: Curves.linear,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Third animation that will be used to change the opacity of the ball to make it disappear</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line">Animation&lt;<span class="built_in">double</span>&gt; disappear = <span class="keyword">new</span> Tween(begin: <span class="number">1.0</span>, end: <span class="number">0.0</span>)</span><br><span class="line">        .animate(</span><br><span class="line">            <span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">                parent: _controller,</span><br><span class="line">                curve:  <span class="keyword">new</span> Interval(</span><br><span class="line">                    <span class="number">0.50</span>,</span><br><span class="line">                    <span class="number">1.0</span>,</span><br><span class="line">                    curve: Curves.linear,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br></pre></td></tr></table></figure>
<p>这就是定义一个场景(或一系列动画)所需要的全部设置。当然，你也可以堆叠子动画。</p>
<h5 id="响应动画状态"><a href="#响应动画状态" class="headerlink" title="响应动画状态"></a>响应动画状态</h5><p>一个动画4个不同的状态：</p>
<ul>
<li>dismissed: 在开始的时候动画停止(或还没开始)</li>
<li>forward: 动画从起点到终点播放</li>
<li>reverse: 动画反向播放，从终点向起点播放</li>
<li>completed：动画在终点结束</li>
</ul>
<p>为了获取这个状态，我们需要监听动画的状态，如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">myAnimation.addStatusListener((AnimationStatus status)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> AnimationStatus.dismissed:</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> AnimationStatus.forward:</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> AnimationStatus.reverse:</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> AnimationStatus.completed:</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>典型用法就是状态切换。例如，一旦动画完成，我们想要反转，可以这样实现：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">myAnimation.addStatusListener((AnimationStatus status)&#123;</span><br><span class="line">    <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// When the animation is at the beginning, we force the animation to play</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="keyword">case</span> AnimationStatus.dismissed:</span><br><span class="line">            _controller.forward();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// When the animation is at the end, we force the animation to reverse</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="keyword">case</span> AnimationStatus.completed:</span><br><span class="line">            _controller.reverse();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="理论到此为止，让我们开始实践吧-（Enough-theory-let’s-practice-now-）"><a href="#理论到此为止，让我们开始实践吧-（Enough-theory-let’s-practice-now-）" class="headerlink" title="理论到此为止，让我们开始实践吧!（Enough theory, let’s practice now !）"></a>理论到此为止，让我们开始实践吧!（Enough theory, let’s practice now !）</h4><p>现在理论已经介绍完了，是时候开始实践了…</p>
<h5 id="动画分析及初始化骨架"><a href="#动画分析及初始化骨架" class="headerlink" title="动画分析及初始化骨架"></a>动画分析及初始化骨架</h5><p>为了有这个<code>guillotine</code>效果，我起初需要考虑的是：</p>
<ul>
<li>页面内容本身</li>
<li>当我们点击菜单（或<code>hamburger</code>）图标的时候，菜单栏能够旋转</li>
<li>当旋转进去的时候，菜单能够重叠页面的内容，填充整个视框</li>
<li>一旦菜单完全展示出来，在我们再次点击的时候，菜单能够旋转进去，为了是能够回到原始的位置和大小</li>
</ul>
<p>通过这些了解，我们立即得出这样的结论我们并没有使用带有<code>AppBar</code>的<code>Scafflod</code>。（因为<code>AppBar</code>是固定的）。</p>
<p>相反，我们使用了<code>Stack</code>，堆叠了两层：</p>
<ul>
<li>页面内容（下层）</li>
<li>菜单（上层）</li>
</ul>
<p>让我们构建这个骨架：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    _MyPageState createState() =&gt; <span class="keyword">new</span> _MyPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyPage</span>&gt;</span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context)&#123;</span><br><span class="line">      <span class="keyword">return</span> SafeArea(</span><br><span class="line">        top: <span class="keyword">false</span>,</span><br><span class="line">        bottom: <span class="keyword">false</span>,</span><br><span class="line">        child: <span class="keyword">new</span> Container(</span><br><span class="line">          child: <span class="keyword">new</span> Stack(</span><br><span class="line">            alignment: Alignment.topLeft,</span><br><span class="line">            children: &lt;Widget&gt;[</span><br><span class="line">              <span class="keyword">new</span> Page(),</span><br><span class="line">              <span class="keyword">new</span> GuillotineMenu(),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Container(</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.only(top: <span class="number">90.0</span>),</span><br><span class="line">            color: Color(<span class="number">0xff222222</span>),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuillotineMenu</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    _GuillotineMenuState createState() =&gt; <span class="keyword">new</span> _GuillotineMenuState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@overrride</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Container(</span><br><span class="line">            color: Color(<span class="number">0xff333333</span>),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码的结果是一个黑屏，只显示了GuillotineMenu，覆盖了整个视图。</p>
<h5 id="菜单分析"><a href="#菜单分析" class="headerlink" title="菜单分析"></a>菜单分析</h5><p>如果你仔细观看视频的话，你会看到，当菜单完全打开的时候，它是完全覆盖视框的，当打开的时候，仅有例如<code>AppBar</code>是可见的。</p>
<p><img src="/2019/01/10/Flutter简易动画教程指南/animation_menu_explaination.png" width="400px" align="center"></p>
<p>我们重写<code>_GuillotineMenuState</code>如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt; </span>&#123;</span><br><span class="line">   <span class="built_in">double</span> rotationAngle = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        MediaQueryData mediaQueryData = MediaQuery.of(context);</span><br><span class="line">		<span class="built_in">double</span> screenWidth = mediaQueryData.size.width;</span><br><span class="line">		<span class="built_in">double</span> screenHeight = mediaQueryData.size.height;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Transform.rotate(</span><br><span class="line">				angle: rotationAngle,</span><br><span class="line">				origin: <span class="keyword">new</span> Offset(<span class="number">24.0</span>, <span class="number">56.0</span>),</span><br><span class="line">				alignment: Alignment.topLeft,</span><br><span class="line">				child: Material(</span><br><span class="line">					color: Colors.transparent,</span><br><span class="line">					child: Container(</span><br><span class="line">					width: screenWidth,</span><br><span class="line">					height: screenHeight,</span><br><span class="line">					color: Color(<span class="number">0xFF333333</span>),</span><br><span class="line">					child: <span class="keyword">new</span> Stack(</span><br><span class="line">						children: &lt;Widget&gt;[</span><br><span class="line">							_buildMenuTitle(),</span><br><span class="line">							_buildMenuIcon(),</span><br><span class="line">							_buildMenuContent(),</span><br><span class="line">						],</span><br><span class="line">					),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Menu Title</span></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	Widget _buildMenuTitle()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Positioned(</span><br><span class="line">			top: <span class="number">32.0</span>,</span><br><span class="line">			left: <span class="number">40.0</span>,</span><br><span class="line">			width: screenWidth,</span><br><span class="line">			height: <span class="number">24.0</span>,</span><br><span class="line">			child: <span class="keyword">new</span> Transform.rotate(</span><br><span class="line">				alignment: Alignment.topLeft,</span><br><span class="line">				origin: Offset.zero,</span><br><span class="line">				angle: pi / <span class="number">2.0</span>,</span><br><span class="line">				child: <span class="keyword">new</span> Center(</span><br><span class="line">				child: <span class="keyword">new</span> Container(</span><br><span class="line">					width: <span class="built_in">double</span>.infinity,</span><br><span class="line">					height: <span class="built_in">double</span>.infinity,</span><br><span class="line">					child: <span class="keyword">new</span> Opacity(</span><br><span class="line">					opacity: <span class="number">1.0</span>,</span><br><span class="line">					child: <span class="keyword">new</span> Text(<span class="string">'ACTIVITY'</span>,</span><br><span class="line">						textAlign: TextAlign.center,</span><br><span class="line">						style: <span class="keyword">new</span> TextStyle(</span><br><span class="line">							color: Colors.white,</span><br><span class="line">							fontSize: <span class="number">20.0</span>,</span><br><span class="line">							fontWeight: FontWeight.bold,</span><br><span class="line">							letterSpacing: <span class="number">2.0</span>,</span><br><span class="line">						)),</span><br><span class="line">					),</span><br><span class="line">				),</span><br><span class="line">			)),</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Menu Icon</span></span><br><span class="line">	<span class="comment">/// </span></span><br><span class="line">	Widget _buildMenuIcon()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Positioned(</span><br><span class="line">			top: <span class="number">32.0</span>,</span><br><span class="line">			left: <span class="number">4.0</span>,</span><br><span class="line">			child: <span class="keyword">new</span> IconButton(</span><br><span class="line">				icon: <span class="keyword">const</span> Icon(</span><br><span class="line">					Icons.menu,</span><br><span class="line">					color: Colors.white,</span><br><span class="line">				),</span><br><span class="line">				onPressed: ()&#123;&#125;,</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Menu content</span></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	Widget _buildMenuContent()&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">Map</span>&gt; _menus = &lt;<span class="built_in">Map</span>&gt;[</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="string">"icon"</span>: Icons.person,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"profile"</span>,</span><br><span class="line">			<span class="string">"color"</span>: Colors.white,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="string">"icon"</span>: Icons.view_agenda,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"feed"</span>,</span><br><span class="line">			<span class="string">"color"</span>: Colors.white,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="string">"icon"</span>: Icons.swap_calls,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"activity"</span>,</span><br><span class="line">			<span class="string">"color"</span>: Colors.cyan,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="string">"icon"</span>: Icons.settings,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"settings"</span>,</span><br><span class="line">			<span class="string">"color"</span>: Colors.white,</span><br><span class="line">			&#125;,</span><br><span class="line">		];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Padding(</span><br><span class="line">			padding: <span class="keyword">const</span> EdgeInsets.only(left: <span class="number">64.0</span>, top: <span class="number">96.0</span>),</span><br><span class="line">			child: <span class="keyword">new</span> Container(</span><br><span class="line">				width: <span class="built_in">double</span>.infinity,</span><br><span class="line">				height: <span class="built_in">double</span>.infinity,</span><br><span class="line">				child: <span class="keyword">new</span> Column(</span><br><span class="line">					mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">					children: _menus.map((menuItem) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">new</span> ListTile(</span><br><span class="line">							leading: <span class="keyword">new</span> Icon(</span><br><span class="line">							menuItem[<span class="string">"icon"</span>],</span><br><span class="line">							color: menuItem[<span class="string">"color"</span>],</span><br><span class="line">							),</span><br><span class="line">							title: <span class="keyword">new</span> Text(</span><br><span class="line">							menuItem[<span class="string">"title"</span>],</span><br><span class="line">							style: <span class="keyword">new</span> TextStyle(</span><br><span class="line">								color: menuItem[<span class="string">"color"</span>],</span><br><span class="line">								fontSize: <span class="number">24.0</span>),</span><br><span class="line">							),</span><br><span class="line">						);</span><br><span class="line">					&#125;).toList(),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第10-13行，定义了<code>Guillotine Menu</code>的旋转，以及旋转中心（菜单图标的位置）</li>
</ul>
<p>此时这段代码的结果会显示出一个未旋转的菜单屏幕(因为rotationAngle = 0.0)，标题垂直展示。</p>
<h5 id="菜单动画"><a href="#菜单动画" class="headerlink" title="菜单动画"></a>菜单动画</h5><p>如果你更新了<code>rotationAngle</code>的值（-π/2 and 0），你将会看到菜单以相应的角度旋转。</p>
<p>来让我们添加写动画…</p>
<p>正如之前所讲的，我们需要：</p>
<ul>
<li>一个<code>SingleTickerProviderStateMixin</code>，因为仅有一个场景</li>
<li>一个<code>AnimationController</code></li>
<li>一个<code>Animation</code>，角度变化</li>
</ul>
<p>代码如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    AnimationController animationControllerMenu;</span><br><span class="line">    Animation&lt;<span class="built_in">double</span>&gt; animationMenu;</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Menu Icon, onPress() handling</span></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">    _handleMenuOpenClose()&#123;</span><br><span class="line">        animationControllerMenu.forward();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> initState()&#123;</span><br><span class="line">        <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">    	<span class="comment">/// Initialization of the animation controller</span></span><br><span class="line">    	<span class="comment">///</span></span><br><span class="line">        animationControllerMenu = <span class="keyword">new</span> AnimationController(</span><br><span class="line">			duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), </span><br><span class="line">			vsync: <span class="keyword">this</span></span><br><span class="line">		)..addListener(()&#123;</span><br><span class="line">            setState(()&#123;&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">    	<span class="comment">/// Initialization of the menu appearance animation</span></span><br><span class="line">    	<span class="comment">///</span></span><br><span class="line">        _rotationAnimation = <span class="keyword">new</span> Tween(</span><br><span class="line">			begin: -pi/<span class="number">2.0</span>, </span><br><span class="line">			end: <span class="number">0.0</span></span><br><span class="line">		).animate(animationControllerMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> dispose()&#123;</span><br><span class="line">        animationControllerMenu.dispose();</span><br><span class="line">        <span class="keyword">super</span>.dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        MediaQueryData mediaQueryData = MediaQuery.of(context);</span><br><span class="line">		<span class="built_in">double</span> screenWidth = mediaQueryData.size.width;</span><br><span class="line">		<span class="built_in">double</span> screenHeight = mediaQueryData.size.height;</span><br><span class="line">		<span class="built_in">double</span> angle = animationMenu.value;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Transform.rotate(</span><br><span class="line">			angle: angle,</span><br><span class="line">			origin: <span class="keyword">new</span> Offset(<span class="number">24.0</span>, <span class="number">56.0</span>),</span><br><span class="line">			alignment: Alignment.topLeft,</span><br><span class="line">			child: Material(</span><br><span class="line">				color: Colors.transparent,</span><br><span class="line">				child: Container(</span><br><span class="line">					width: screenWidth,</span><br><span class="line">					height: screenHeight,</span><br><span class="line">					color: Color(<span class="number">0xFF333333</span>),</span><br><span class="line">					child: <span class="keyword">new</span> Stack(</span><br><span class="line">						children: &lt;Widget&gt;[</span><br><span class="line">							_buildMenuTitle(),</span><br><span class="line">							_buildMenuIcon(),</span><br><span class="line">							_buildMenuContent(),</span><br><span class="line">						],</span><br><span class="line">					),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Menu Icon</span></span><br><span class="line">	<span class="comment">/// </span></span><br><span class="line">	Widget _buildMenuIcon()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Positioned(</span><br><span class="line">			top: <span class="number">32.0</span>,</span><br><span class="line">			left: <span class="number">4.0</span>,</span><br><span class="line">			child: <span class="keyword">new</span> IconButton(</span><br><span class="line">				icon: <span class="keyword">const</span> Icon(</span><br><span class="line">					Icons.menu,</span><br><span class="line">					color: Colors.white,</span><br><span class="line">				),</span><br><span class="line">				onPressed: _handleMenuOpenClose,</span><br><span class="line">			),</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们按下这个菜单按钮的时候，菜单会打开，但当我们再次按下按钮时不会关闭。这里是<code>AnimationStatus</code>发挥的作用。</p>
<p>添加基于<code>AnimationStatus</code>的监听器，决定是否<code>forward</code>或<code>reverse</code>动画。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Menu animation status</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">enum</span> _GuillotineAnimationStatus &#123; closed, open, animating &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">    AnimationController animationControllerMenu;</span><br><span class="line">    Animation&lt;<span class="built_in">double</span>&gt; animationMenu;</span><br><span class="line">    _GuillotineAnimationStatus menuAnimationStatus = _GuillotineAnimationStatus.closed;</span><br><span class="line"></span><br><span class="line">    _handleMenuOpenClose()&#123;</span><br><span class="line">        <span class="keyword">if</span> (menuAnimationStatus == _GuillotineAnimationStatus.closed)&#123;</span><br><span class="line">            animationControllerMenu.forward().orCancel;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (menuAnimationStatus == _GuillotineAnimationStatus.open) &#123;</span><br><span class="line">            animationControllerMenu.reverse().orCancel;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> initState()&#123;</span><br><span class="line">        <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">    	<span class="comment">/// Initialization of the animation controller</span></span><br><span class="line">    	<span class="comment">///</span></span><br><span class="line">        animationControllerMenu = <span class="keyword">new</span> AnimationController(</span><br><span class="line">			duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), </span><br><span class="line">			vsync: <span class="keyword">this</span></span><br><span class="line">		)..addListener(()&#123;</span><br><span class="line">            setState(()&#123;&#125;);</span><br><span class="line">        &#125;)..addStatusListener((AnimationStatus status) &#123;</span><br><span class="line">            <span class="keyword">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">		<span class="comment">/// When the animation is at the end, the menu is open</span></span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">              menuAnimationStatus = _GuillotineAnimationStatus.open;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status == AnimationStatus.dismissed) &#123;</span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">		<span class="comment">/// When the animation is at the beginning, the menu is closed</span></span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">              menuAnimationStatus = _GuillotineAnimationStatus.closed;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">		<span class="comment">/// Otherwise the animation is running</span></span><br><span class="line">		<span class="comment">///</span></span><br><span class="line">              menuAnimationStatus = _GuillotineAnimationStatus.animating;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，这个菜单已经按照预期打开或关闭，但是视频中展示的打开/关闭动作不是线性的，看起来似乎有一个反弹效果，让我们添加上这个效果。</p>
<p>选择下面这两个效果：</p>
<ul>
<li>bounceOut，菜单打开</li>
<li>bounceIn，菜单关闭</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> initState()&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// Initialization of the menu appearance animation</span></span><br><span class="line">	<span class="comment">/// </span></span><br><span class="line">	animationMenu = <span class="keyword">new</span> Tween(</span><br><span class="line">		begin: -pi / <span class="number">2.0</span>, </span><br><span class="line">		end: <span class="number">0.0</span></span><br><span class="line">	).animate(<span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">		parent: animationControllerMenu,</span><br><span class="line">		curve: Curves.bounceOut,</span><br><span class="line">		reverseCurve: Curves.bounceIn,</span><br><span class="line">	));</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个实现中仍然有一些遗漏的东西……事实上，标题在打开菜单时消失，在关闭菜单时重新出现，这是一个<code>fadeIn/fadeOut</code>的效果，同样也要被处理成动画。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GuillotineMenuState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">GuillotineMenu</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController animationControllerMenu;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; animationMenu;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; animationTitleFadeInOut;</span><br><span class="line">  _GuillotineAnimationStatus menuAnimationStatus;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState()&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Initialization of the menu title fade out/in animation</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    animationTitleFadeInOut = <span class="keyword">new</span> Tween(</span><br><span class="line">		begin: <span class="number">1.0</span>, </span><br><span class="line">		end: <span class="number">0.0</span></span><br><span class="line">	).animate(<span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">      	parent: animationControllerMenu,</span><br><span class="line">      	curve: <span class="keyword">new</span> Interval(</span><br><span class="line">        	<span class="number">0.0</span>,</span><br><span class="line">        	<span class="number">0.5</span>,</span><br><span class="line">        	curve: Curves.ease,</span><br><span class="line">      	),</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Menu Title</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  Widget _buildMenuTitle()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Positioned(</span><br><span class="line">	  top: <span class="number">32.0</span>,</span><br><span class="line">	  left: <span class="number">40.0</span>,</span><br><span class="line">	  width: screenWidth,</span><br><span class="line">	  height: <span class="number">24.0</span>,</span><br><span class="line">	  child: <span class="keyword">new</span> Transform.rotate(</span><br><span class="line">		alignment: Alignment.topLeft,</span><br><span class="line">		origin: Offset.zero,</span><br><span class="line">		angle: pi / <span class="number">2.0</span>,</span><br><span class="line">		child: <span class="keyword">new</span> Center(</span><br><span class="line">	  	  child: <span class="keyword">new</span> Container(</span><br><span class="line">			width: <span class="built_in">double</span>.infinity,</span><br><span class="line">			height: <span class="built_in">double</span>.infinity,</span><br><span class="line">		  	  child: <span class="keyword">new</span> Opacity(</span><br><span class="line">			    opacity: animationTitleFadeInOut.value,</span><br><span class="line">				child: <span class="keyword">new</span> Text(<span class="string">'ACTIVITY'</span>,</span><br><span class="line">					textAlign: TextAlign.center,</span><br><span class="line">					style: <span class="keyword">new</span> TextStyle(</span><br><span class="line">						color: Colors.white,</span><br><span class="line">						fontSize: <span class="number">20.0</span>,</span><br><span class="line">						fontWeight: FontWeight.bold,</span><br><span class="line">						letterSpacing: <span class="number">2.0</span>,</span><br><span class="line">					)),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		)),</span><br><span class="line">	);</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><p>这篇文章的完成源码在<a href="https://github.com/boeledi/guillotine" target="_blank" rel="noopener">GitHub</a>。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/10/深入学习Flutter之Transform/" rel="next" title="深入学习Flutter之Transform">
                <i class="fa fa-chevron-left"></i> 深入学习Flutter之Transform
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">编号15077</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#动画三大支柱-（The-3-pillars-of-an-Animation）"><span class="nav-number">1.</span> <span class="nav-text">动画三大支柱 （The 3 pillars of an Animation）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Ticker"><span class="nav-number">1.1.</span> <span class="nav-text">Ticker</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Animation"><span class="nav-number">1.2.</span> <span class="nav-text">Animation</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AnimationController"><span class="nav-number">1.3.</span> <span class="nav-text">AnimationController</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动画控制器-（AnimationController）"><span class="nav-number">2.</span> <span class="nav-text">动画控制器 （AnimationController）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#如何将动画控制器绑定到Ticker？"><span class="nav-number">2.1.</span> <span class="nav-text">如何将动画控制器绑定到Ticker？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#控制器已经绑定到Ticker上，但是这有什么作用呢？"><span class="nav-number">2.2.</span> <span class="nav-text">控制器已经绑定到Ticker上，但是这有什么作用呢？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动画的概念-（The-notion-of-Animation）"><span class="nav-number">3.</span> <span class="nav-text">动画的概念 （The notion of Animation）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用其他类型的值"><span class="nav-number">3.1.</span> <span class="nav-text">使用其他类型的值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用不同的值范围"><span class="nav-number">3.2.</span> <span class="nav-text">使用不同的值范围</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变体类型"><span class="nav-number">3.3.</span> <span class="nav-text">变体类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#控制动画-（Controlling-the-animation）"><span class="nav-number">4.</span> <span class="nav-text">控制动画 （Controlling the animation）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#保证安全"><span class="nav-number">4.1.</span> <span class="nav-text">保证安全</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#场景的概念"><span class="nav-number">4.2.</span> <span class="nav-text">场景的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#间隔的概念"><span class="nav-number">4.3.</span> <span class="nav-text">间隔的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#响应动画状态"><span class="nav-number">4.4.</span> <span class="nav-text">响应动画状态</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#理论到此为止，让我们开始实践吧-（Enough-theory-let’s-practice-now-）"><span class="nav-number">5.</span> <span class="nav-text">理论到此为止，让我们开始实践吧!（Enough theory, let’s practice now !）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#动画分析及初始化骨架"><span class="nav-number">5.1.</span> <span class="nav-text">动画分析及初始化骨架</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#菜单分析"><span class="nav-number">5.2.</span> <span class="nav-text">菜单分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#菜单动画"><span class="nav-number">5.3.</span> <span class="nav-text">菜单动画</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#源码"><span class="nav-number">6.</span> <span class="nav-text">源码</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">编号15077</span>

  
</div>









        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
